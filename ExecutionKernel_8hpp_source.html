<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>StencilStream: StencilStream/ExecutionKernel.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">StencilStream
   &#160;<span id="projectnumber">v2.0.0</span>
   </div>
   <div id="projectbrief">Generic Stencil Simulation Library for FPGAs.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5e2394f53400ec3b819dca9374f90d55.html">StencilStream</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ExecutionKernel.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright © 2020-2021 Jan-Oliver Opdenhövel, Paderborn Center for Parallel Computing, Paderborn University</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#pragma once</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;GenericID.hpp&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;Index.hpp&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;Stencil.hpp&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">namespace </span>stencil</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;{</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TransFunc, <span class="keyword">typename</span> T, uindex_t stencil_radius, uindex_t pipeline_length, uindex_t output_tile_w<span class="keywordtype">id</span>th, uindex_t output_tile_height, <span class="keyword">typename</span> in_pipe, <span class="keyword">typename</span> out_pipe&gt;</div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="classstencil_1_1ExecutionKernel.html">   34</a></span>&#160;<span class="keyword">class </span><a class="code" href="classstencil_1_1ExecutionKernel.html">ExecutionKernel</a></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;{</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    static_assert(</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        std::is_invocable_r&lt;T, TransFunc <span class="keyword">const</span>, <a class="code" href="classstencil_1_1Stencil.html">Stencil&lt;T, stencil_radius&gt;</a> <span class="keyword">const</span> &amp;&gt;::</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;            value);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    static_assert(stencil_radius &gt;= 1);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">   45</a></span>&#160;    <span class="keyword">const</span> <span class="keyword">static</span> uindex_t <a class="code" href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">stencil_diameter</a> = <a class="code" href="classstencil_1_1Stencil.html">Stencil&lt;T, stencil_radius&gt;::diameter</a>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="classstencil_1_1ExecutionKernel.html#ab3da80b930132d7cf013f1f7bc8420d1">   50</a></span>&#160;    <span class="keyword">const</span> <span class="keyword">static</span> uindex_t <a class="code" href="classstencil_1_1ExecutionKernel.html#ab3da80b930132d7cf013f1f7bc8420d1">n_input_cells</a> = (2 * stencil_radius * pipeline_length + output_tile_width) * (2 * stencil_radius * pipeline_length + output_tile_height);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="classstencil_1_1ExecutionKernel.html#abb86ead22063efe4b67ecca08faf5e43">   55</a></span>&#160;    <span class="keyword">const</span> <span class="keyword">static</span> uindex_t <a class="code" href="classstencil_1_1ExecutionKernel.html#abb86ead22063efe4b67ecca08faf5e43">input_tile_width</a> = 2 * stencil_radius * pipeline_length + output_tile_width;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="classstencil_1_1ExecutionKernel.html#a507df120323433fc90be06655c42f07e">   60</a></span>&#160;    <span class="keyword">const</span> <span class="keyword">static</span> uindex_t <a class="code" href="classstencil_1_1ExecutionKernel.html#a507df120323433fc90be06655c42f07e">input_tile_height</a> = 2 * stencil_radius * pipeline_length + output_tile_height;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="classstencil_1_1ExecutionKernel.html#a9354c864ff2963fa8844e0a121fab869">   73</a></span>&#160;    <a class="code" href="classstencil_1_1ExecutionKernel.html#a9354c864ff2963fa8844e0a121fab869">ExecutionKernel</a>(</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        TransFunc trans_func,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        uindex_t i_generation,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        uindex_t n_generations,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        uindex_t grid_c_offset,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        uindex_t grid_r_offset,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        uindex_t grid_width,</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        uindex_t grid_height,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        T halo_value) : trans_func(trans_func),</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                        i_generation(i_generation),</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                        n_generations(n_generations),</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                        grid_c_offset(grid_c_offset),</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                        grid_r_offset(grid_r_offset),</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                        grid_width(grid_width),</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                        grid_height(grid_height),</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                        halo_value(halo_value)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="classstencil_1_1ExecutionKernel.html#ae4f1cbed004773f64edc83e5b13ca0af">   95</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classstencil_1_1ExecutionKernel.html#ae4f1cbed004773f64edc83e5b13ca0af">operator()</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        uindex_t input_tile_c = 0;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        uindex_t input_tile_r = 0;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        [[intel::fpga_memory, intel::numbanks(2 * pipeline_length)]] T cache[2][<a class="code" href="classstencil_1_1ExecutionKernel.html#a507df120323433fc90be06655c42f07e">input_tile_height</a>][pipeline_length][<a class="code" href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">stencil_diameter</a> - 1];</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        uindex_t active_cache = 0;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        [[intel::fpga_register]] T stencil_buffer[pipeline_length][<a class="code" href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">stencil_diameter</a>][<a class="code" href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">stencil_diameter</a>];</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordflow">for</span> (uindex_t i = 0; i &lt; <a class="code" href="classstencil_1_1ExecutionKernel.html#ab3da80b930132d7cf013f1f7bc8420d1">n_input_cells</a>; i++)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            T value = in_pipe::read();</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#pragma unroll</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <span class="keywordflow">for</span> (uindex_t stage = 0; stage &lt; pipeline_length; stage++)</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                <span class="comment">/*</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">                 * Shift up every value in the stencil_buffer.</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">                 * This operation does not touch the values in the bottom row, which will be filled</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">                 * from the cache and the new input value later.</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">#pragma unroll</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                <span class="keywordflow">for</span> (uindex_t r = 0; r &lt; <a class="code" href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">stencil_diameter</a> - 1; r++)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#pragma unroll</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                    <span class="keywordflow">for</span> (uindex_t c = 0; c &lt; <a class="code" href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">stencil_diameter</a>; c++)</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                    {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                        stencil_buffer[stage][c][r] = stencil_buffer[stage][c][r + 1];</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                    }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                index_t input_grid_c = grid_c_offset + index_t(input_tile_c) - (<a class="code" href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">stencil_diameter</a> - 1) - (pipeline_length + stage - 2) * stencil_radius;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                index_t input_grid_r = grid_r_offset + index_t(input_tile_r) - (<a class="code" href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">stencil_diameter</a> - 1) - (pipeline_length + stage - 2) * stencil_radius;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                <span class="comment">// Update the stencil buffer and cache with previous cache contents and the new input cell.</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#pragma unroll</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                <span class="keywordflow">for</span> (uindex_t cache_c = 0; cache_c &lt; <a class="code" href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">stencil_diameter</a>; cache_c++)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                    T new_value;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                    <span class="keywordflow">if</span> (cache_c == <a class="code" href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">stencil_diameter</a> - 1)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                    {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                        <span class="keywordflow">if</span> (input_grid_c &lt; 0 || input_grid_r &lt; 0 || input_grid_c &gt;= grid_width || input_grid_r &gt;= grid_height)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                        {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                            new_value = halo_value;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                        }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                        {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                            new_value = value;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                        }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                    }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                    {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                        new_value = cache[active_cache][input_tile_r][stage][cache_c];</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                    }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                    stencil_buffer[stage][cache_c][<a class="code" href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">stencil_diameter</a> - 1] = new_value;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                    <span class="keywordflow">if</span> (cache_c &gt; 0)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                    {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                        cache[active_cache == 0 ? 1 : 0][input_tile_r][stage][cache_c - 1] = new_value;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                    }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                index_t output_grid_c = input_grid_c - stencil_radius;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                index_t output_grid_r = input_grid_r - stencil_radius;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                <a class="code" href="classstencil_1_1Stencil.html">Stencil&lt;T, stencil_radius&gt;</a> stencil(</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                    <a class="code" href="classstencil_1_1GenericID.html">ID</a>(output_grid_c, output_grid_r),</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                    i_generation + stage,</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                    stage,</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                    stencil_buffer[stage],</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                    <a class="code" href="classstencil_1_1GenericID.html">UID</a>(grid_width, grid_height));</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                <span class="keywordflow">if</span> (i_generation + stage &lt; n_generations)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                    value = trans_func(stencil);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                    value = stencil_buffer[stage][stencil_radius][stencil_radius];</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="keywordtype">bool</span> is_valid_output = input_tile_c &gt;= (<a class="code" href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">stencil_diameter</a> - 1) * pipeline_length;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            is_valid_output &amp;= input_tile_r &gt;= (<a class="code" href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">stencil_diameter</a> - 1) * pipeline_length;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="keywordflow">if</span> (is_valid_output)</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                out_pipe::write(value);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <span class="keywordflow">if</span> (input_tile_r == <a class="code" href="classstencil_1_1ExecutionKernel.html#a507df120323433fc90be06655c42f07e">input_tile_height</a> - 1)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                active_cache = active_cache == 0 ? 1 : 0;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                input_tile_r = 0;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <span class="keywordflow">if</span> (input_tile_c == <a class="code" href="classstencil_1_1ExecutionKernel.html#abb86ead22063efe4b67ecca08faf5e43">input_tile_width</a> - 1)</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                    input_tile_c = 0;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                    input_tile_c++;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                input_tile_r++;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    TransFunc trans_func;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    uindex_t i_generation;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    uindex_t n_generations;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    uindex_t grid_c_offset;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    uindex_t grid_r_offset;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    uindex_t grid_width;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    uindex_t grid_height;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    T halo_value;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;};</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;} <span class="comment">// namespace stencil</span></div>
<div class="ttc" id="aclassstencil_1_1ExecutionKernel_html"><div class="ttname"><a href="classstencil_1_1ExecutionKernel.html">stencil::ExecutionKernel</a></div><div class="ttdoc">A kernel that executes a stencil transition function on a tile.</div><div class="ttdef"><b>Definition:</b> ExecutionKernel.hpp:35</div></div>
<div class="ttc" id="aclassstencil_1_1ExecutionKernel_html_a47e5d209000fb8ff22b26fa83f6d998b"><div class="ttname"><a href="classstencil_1_1ExecutionKernel.html#a47e5d209000fb8ff22b26fa83f6d998b">stencil::ExecutionKernel::stencil_diameter</a></div><div class="ttdeci">static const uindex_t stencil_diameter</div><div class="ttdoc">The width and height of the stencil buffer.</div><div class="ttdef"><b>Definition:</b> ExecutionKernel.hpp:45</div></div>
<div class="ttc" id="aclassstencil_1_1ExecutionKernel_html_a507df120323433fc90be06655c42f07e"><div class="ttname"><a href="classstencil_1_1ExecutionKernel.html#a507df120323433fc90be06655c42f07e">stencil::ExecutionKernel::input_tile_height</a></div><div class="ttdeci">static const uindex_t input_tile_height</div><div class="ttdoc">The height of the processed tile with the tile halo attached.</div><div class="ttdef"><b>Definition:</b> ExecutionKernel.hpp:60</div></div>
<div class="ttc" id="aclassstencil_1_1ExecutionKernel_html_a9354c864ff2963fa8844e0a121fab869"><div class="ttname"><a href="classstencil_1_1ExecutionKernel.html#a9354c864ff2963fa8844e0a121fab869">stencil::ExecutionKernel::ExecutionKernel</a></div><div class="ttdeci">ExecutionKernel(TransFunc trans_func, uindex_t i_generation, uindex_t n_generations, uindex_t grid_c_offset, uindex_t grid_r_offset, uindex_t grid_width, uindex_t grid_height, T halo_value)</div><div class="ttdoc">Create and configure the execution kernel.</div><div class="ttdef"><b>Definition:</b> ExecutionKernel.hpp:73</div></div>
<div class="ttc" id="aclassstencil_1_1ExecutionKernel_html_ab3da80b930132d7cf013f1f7bc8420d1"><div class="ttname"><a href="classstencil_1_1ExecutionKernel.html#ab3da80b930132d7cf013f1f7bc8420d1">stencil::ExecutionKernel::n_input_cells</a></div><div class="ttdeci">static const uindex_t n_input_cells</div><div class="ttdoc">The total number of cells to read from the in_pipe.</div><div class="ttdef"><b>Definition:</b> ExecutionKernel.hpp:50</div></div>
<div class="ttc" id="aclassstencil_1_1ExecutionKernel_html_abb86ead22063efe4b67ecca08faf5e43"><div class="ttname"><a href="classstencil_1_1ExecutionKernel.html#abb86ead22063efe4b67ecca08faf5e43">stencil::ExecutionKernel::input_tile_width</a></div><div class="ttdeci">static const uindex_t input_tile_width</div><div class="ttdoc">The width of the processed tile with the tile halo attached.</div><div class="ttdef"><b>Definition:</b> ExecutionKernel.hpp:55</div></div>
<div class="ttc" id="aclassstencil_1_1ExecutionKernel_html_ae4f1cbed004773f64edc83e5b13ca0af"><div class="ttname"><a href="classstencil_1_1ExecutionKernel.html#ae4f1cbed004773f64edc83e5b13ca0af">stencil::ExecutionKernel::operator()</a></div><div class="ttdeci">void operator()() const</div><div class="ttdoc">Execute the configured operations.</div><div class="ttdef"><b>Definition:</b> ExecutionKernel.hpp:95</div></div>
<div class="ttc" id="aclassstencil_1_1GenericID_html"><div class="ttname"><a href="classstencil_1_1GenericID.html">stencil::GenericID</a></div><div class="ttdoc">A generic, two-dimensional index.</div><div class="ttdef"><b>Definition:</b> GenericID.hpp:24</div></div>
<div class="ttc" id="aclassstencil_1_1Stencil_html"><div class="ttname"><a href="classstencil_1_1Stencil.html">stencil::Stencil</a></div><div class="ttdoc">The stencil buffer.</div><div class="ttdef"><b>Definition:</b> Stencil.hpp:28</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
